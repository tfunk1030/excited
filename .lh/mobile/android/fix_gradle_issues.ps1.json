{
    "sourceFile": "mobile/android/fix_gradle_issues.ps1",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1736487474147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1736492423940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,37 +10,37 @@\n # Verify Java version\r\n Write-Host \"Verifying Java version...\"\r\n java -version\r\n \r\n+# Function to handle errors\r\n+function Handle-Error {\r\n+    param($ErrorMessage)\r\n+    Write-Host \"Error: $ErrorMessage\" -ForegroundColor Red\r\n+    Write-Host \"Attempting recovery...\" -ForegroundColor Yellow\r\n+}\r\n+\r\n # Clean Gradle caches thoroughly\r\n Write-Host \"Cleaning Gradle caches...\"\r\n $gradleHome = \"$env:USERPROFILE\\.gradle\"\r\n \r\n-# Remove specific problematic directories\r\n-$dirsToRemove = @(\r\n-    \"caches\\8.10.2\",\r\n-    \"caches\\transforms-*\",\r\n-    \"caches\\build-cache-*\",\r\n-    \"daemon\",\r\n-    \"native\",\r\n-    \"workers\"\r\n-)\r\n-\r\n-foreach ($dir in $dirsToRemove) {\r\n-    $path = Join-Path $gradleHome $dir\r\n-    if (Test-Path $path) {\r\n-        Write-Host \"Removing $path...\"\r\n-        Remove-Item -Path $path -Recurse -Force -ErrorAction SilentlyContinue\r\n+try {\r\n+    # Stop all Java processes\r\n+    Write-Host \"Stopping Java processes...\"\r\n+    Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue\r\n+    \r\n+    # Remove entire .gradle directory\r\n+    if (Test-Path $gradleHome) {\r\n+        Write-Host \"Removing entire .gradle directory...\"\r\n+        Remove-Item -Path $gradleHome -Recurse -Force\r\n     }\r\n-}\r\n-\r\n-# Clean Android build directories\r\n-Write-Host \"Cleaning Android build directories...\"\r\n-Remove-Item -Path \"build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n-Remove-Item -Path \"app/build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n-Remove-Item -Path \".gradle\" -Recurse -Force -ErrorAction SilentlyContinue\r\n-\r\n-# Clean project\r\n+    \r\n+    # Recreate essential directories\r\n+    Write-Host \"Recreating essential directories...\"\r\n+    New-Item -ItemType Directory -Path $gradleHome -Force | Out-Null\r\n+    New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\" -Force | Out-Null\r\n+    New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\\dists\" -Force | Out-Null\r\n+} catch {\r\n+    Handle-Error $_.Exception.Message\r\n Write-Host \"Cleaning project...\"\r\n ./gradlew clean\r\n \r\n # Update Gradle wrapper\r\n"
                },
                {
                    "date": 1736492430864,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,14 +39,50 @@\n     New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\" -Force | Out-Null\r\n     New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\\dists\" -Force | Out-Null\r\n } catch {\r\n     Handle-Error $_.Exception.Message\r\n-Write-Host \"Cleaning project...\"\r\n-./gradlew clean\r\n+}\r\n \r\n-# Update Gradle wrapper\r\n-Write-Host \"Updating Gradle wrapper...\"\r\n-./gradlew wrapper --gradle-version 8.0.0\r\n+# Clean Android build directories\r\n+Write-Host \"Cleaning Android build directories...\"\r\n+try {\r\n+    Get-ChildItem -Path \".\" -Include \"build\", \".gradle\" -Recurse -Directory | \r\n+        ForEach-Object { Remove-Item $_.FullName -Recurse -Force }\r\n+} catch {\r\n+    Handle-Error $_.Exception.Message\r\n+}\r\n \r\n-# Build project with debug info\r\n-Write-Host \"Building project...\"\r\n-./gradlew assembleDebug --info --stacktrace --no-daemon\r\n+# Update Gradle wrapper properties\r\n+Write-Host \"Updating Gradle wrapper properties...\"\r\n+try {\r\n+    $wrapperPath = \"gradle/wrapper/gradle-wrapper.properties\"\r\n+    $wrapperContent = @\"\r\n+distributionBase=GRADLE_USER_HOME\r\n+distributionPath=wrapper/dists\r\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-8.0.0-bin.zip\r\n+networkTimeout=10000\r\n+validateDistributionUrl=true\r\n+zipStoreBase=GRADLE_USER_HOME\r\n+zipStorePath=wrapper/dists\r\n+\"@\r\n+    Set-Content -Path $wrapperPath -Value $wrapperContent -Force\r\n+} catch {\r\n+    Handle-Error $_.Exception.Message\r\n+}\r\n+\r\n+# Clean and build project\r\n+Write-Host \"Cleaning and building project...\"\r\n+try {\r\n+    # Clean project\r\n+    ./gradlew clean --no-daemon --refresh-dependencies\r\n+\r\n+    # Update wrapper\r\n+    ./gradlew wrapper --gradle-version 8.0.0 --no-daemon\r\n+\r\n+    # Build with debug info\r\n+    Write-Host \"Building project with debug info...\"\r\n+    ./gradlew assembleDebug --info --stacktrace --no-daemon --refresh-dependencies\r\n+} catch {\r\n+    Handle-Error $_.Exception.Message\r\n+    Write-Host \"Build failed. Check the error messages above for details.\" -ForegroundColor Red\r\n+    exit 1\r\n+}\r\n"
                },
                {
                    "date": 1736493293759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,88 +1,78 @@\n-# Stop any running Gradle daemons\r\n+# Script to fix common Gradle issues in React Native Android builds\r\n+\r\n Write-Host \"Stopping Gradle daemon...\"\r\n ./gradlew --stop\r\n \r\n-# Set Java 17 environment variables\r\n-$javaHome = \"C:\\Users\\tfunk\\.gradle\\jdks\\eclipse_adoptium-17-amd64-windows.2\"\r\n-$env:JAVA_HOME = $javaHome\r\n-$env:PATH = \"$javaHome\\bin;$env:PATH\"\r\n+# Kill any running Java processes\r\n+Write-Host \"Stopping Java processes...\"\r\n+Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force\r\n \r\n-# Verify Java version\r\n-Write-Host \"Verifying Java version...\"\r\n-java -version\r\n-\r\n-# Function to handle errors\r\n-function Handle-Error {\r\n-    param($ErrorMessage)\r\n-    Write-Host \"Error: $ErrorMessage\" -ForegroundColor Red\r\n-    Write-Host \"Attempting recovery...\" -ForegroundColor Yellow\r\n+# Set correct Java home\r\n+$javaHome = \"C:\\Program Files\\Java\\jdk-17\"\r\n+if (Test-Path $javaHome) {\r\n+    Write-Host \"Setting JAVA_HOME to $javaHome\"\r\n+    $env:JAVA_HOME = $javaHome\r\n+    \r\n+    # Also update the Path\r\n+    $env:Path = \"$javaHome\\bin;$env:Path\"\r\n+} else {\r\n+    Write-Error \"Java 17 not found at $javaHome. Please install JDK 17.\"\r\n+    exit 1\r\n }\r\n \r\n-# Clean Gradle caches thoroughly\r\n+# Clean Gradle caches\r\n Write-Host \"Cleaning Gradle caches...\"\r\n $gradleHome = \"$env:USERPROFILE\\.gradle\"\r\n-\r\n-try {\r\n-    # Stop all Java processes\r\n-    Write-Host \"Stopping Java processes...\"\r\n-    Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue\r\n-    \r\n-    # Remove entire .gradle directory\r\n-    if (Test-Path $gradleHome) {\r\n-        Write-Host \"Removing entire .gradle directory...\"\r\n-        Remove-Item -Path $gradleHome -Recurse -Force\r\n+if (Test-Path $gradleHome) {\r\n+    try {\r\n+        # Remove specific problematic directories\r\n+        Remove-Item \"$gradleHome\\caches\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+        Remove-Item \"$gradleHome\\daemon\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+        Remove-Item \"$gradleHome\\wrapper\\dists\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    } catch {\r\n+        Write-Warning \"Some files could not be deleted. This is normal if Gradle is still running.\"\r\n     }\r\n-    \r\n-    # Recreate essential directories\r\n-    Write-Host \"Recreating essential directories...\"\r\n-    New-Item -ItemType Directory -Path $gradleHome -Force | Out-Null\r\n-    New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\" -Force | Out-Null\r\n-    New-Item -ItemType Directory -Path \"$gradleHome\\wrapper\\dists\" -Force | Out-Null\r\n-} catch {\r\n-    Handle-Error $_.Exception.Message\r\n }\r\n \r\n+# Recreate essential directories\r\n+Write-Host \"Recreating essential directories...\"\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\caches\" | Out-Null\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\daemon\" | Out-Null\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\wrapper\\dists\" | Out-Null\r\n+\r\n # Clean Android build directories\r\n Write-Host \"Cleaning Android build directories...\"\r\n-try {\r\n-    Get-ChildItem -Path \".\" -Include \"build\", \".gradle\" -Recurse -Directory | \r\n-        ForEach-Object { Remove-Item $_.FullName -Recurse -Force }\r\n-} catch {\r\n-    Handle-Error $_.Exception.Message\r\n-}\r\n+Remove-Item \"app\\build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+Remove-Item \"build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+Remove-Item \".gradle\" -Recurse -Force -ErrorAction SilentlyContinue\r\n \r\n-# Update Gradle wrapper properties\r\n+# Update Gradle wrapper properties to use correct version\r\n Write-Host \"Updating Gradle wrapper properties...\"\r\n-try {\r\n-    $wrapperPath = \"gradle/wrapper/gradle-wrapper.properties\"\r\n-    $wrapperContent = @\"\r\n-distributionBase=GRADLE_USER_HOME\r\n-distributionPath=wrapper/dists\r\n-distributionUrl=https\\://services.gradle.org/distributions/gradle-8.0.0-bin.zip\r\n-networkTimeout=10000\r\n-validateDistributionUrl=true\r\n-zipStoreBase=GRADLE_USER_HOME\r\n-zipStorePath=wrapper/dists\r\n-\"@\r\n-    Set-Content -Path $wrapperPath -Value $wrapperContent -Force\r\n-} catch {\r\n-    Handle-Error $_.Exception.Message\r\n+$wrapperPath = \"gradle\\wrapper\\gradle-wrapper.properties\"\r\n+if (Test-Path $wrapperPath) {\r\n+    $content = Get-Content $wrapperPath -Raw\r\n+    $content = $content -replace \"gradle-[0-9]+\\.[0-9]+(\\.[0-9]+)?-\", \"gradle-7.3.1-\"\r\n+    $content | Set-Content $wrapperPath -Force\r\n }\r\n \r\n # Clean and build project\r\n Write-Host \"Cleaning and building project...\"\r\n-try {\r\n-    # Clean project\r\n-    ./gradlew clean --no-daemon --refresh-dependencies\r\n+./gradlew clean\r\n \r\n-    # Update wrapper\r\n-    ./gradlew wrapper --gradle-version 8.0.0 --no-daemon\r\n+Write-Host \"Building project with debug info...\"\r\n+./gradlew assembleDebug --info\r\n \r\n-    # Build with debug info\r\n-    Write-Host \"Building project with debug info...\"\r\n-    ./gradlew assembleDebug --info --stacktrace --no-daemon --refresh-dependencies\r\n-} catch {\r\n-    Handle-Error $_.Exception.Message\r\n-    Write-Host \"Build failed. Check the error messages above for details.\" -ForegroundColor Red\r\n-    exit 1\r\n+# Additional cleanup if needed\r\n+if ($LASTEXITCODE -ne 0) {\r\n+    Write-Host \"Build failed. Trying additional cleanup...\"\r\n+    \r\n+    # Remove node_modules/.cache\r\n+    Remove-Item \"../node_modules/.cache\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    \r\n+    # Clear Metro bundler cache\r\n+    Remove-Item \"$env:TEMP/metro-*\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    \r\n+    # Try rebuild\r\n+    Write-Host \"Attempting rebuild...\"\r\n+    ./gradlew clean assembleDebug --info\r\n }\r\n"
                },
                {
                    "date": 1736493324924,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,10 +6,10 @@\n # Kill any running Java processes\r\n Write-Host \"Stopping Java processes...\"\r\n Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force\r\n \r\n-# Set correct Java home\r\n-$javaHome = \"C:\\Program Files\\Java\\jdk-17\"\r\n+# Set correct Java home for Temurin JDK 17\r\n+$javaHome = \"C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.13.11-hotspot\"\r\n if (Test-Path $javaHome) {\r\n     Write-Host \"Setting JAVA_HOME to $javaHome\"\r\n     $env:JAVA_HOME = $javaHome\r\n     \r\n"
                },
                {
                    "date": 1736493335473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,9 +15,9 @@\n     \r\n     # Also update the Path\r\n     $env:Path = \"$javaHome\\bin;$env:Path\"\r\n } else {\r\n-    Write-Error \"Java 17 not found at $javaHome. Please install JDK 17.\"\r\n+    Write-Error \"Temurin JDK 17 not found at $javaHome. Please verify installation.\"\r\n     exit 1\r\n }\r\n \r\n # Clean Gradle caches\r\n@@ -54,8 +54,16 @@\n     $content = $content -replace \"gradle-[0-9]+\\.[0-9]+(\\.[0-9]+)?-\", \"gradle-7.3.1-\"\r\n     $content | Set-Content $wrapperPath -Force\r\n }\r\n \r\n+# Update local.properties with correct SDK path\r\n+Write-Host \"Updating local.properties...\"\r\n+$localProperties = \"local.properties\"\r\n+$sdkDir = $env:ANDROID_HOME -replace \"\\\\\", \"\\\\\"\r\n+if ($sdkDir) {\r\n+    \"sdk.dir=$sdkDir\" | Set-Content $localProperties -Force\r\n+}\r\n+\r\n # Clean and build project\r\n Write-Host \"Cleaning and building project...\"\r\n ./gradlew clean\r\n \r\n"
                },
                {
                    "date": 1736494309928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n # Kill any running Java processes\r\n Write-Host \"Stopping Java processes...\"\r\n Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force\r\n \r\n-# Set correct Java home for Temurin JDK 17\r\n+# Set correct Java home\r\n $javaHome = \"C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.13.11-hotspot\"\r\n if (Test-Path $javaHome) {\r\n     Write-Host \"Setting JAVA_HOME to $javaHome\"\r\n     $env:JAVA_HOME = $javaHome\r\n"
                },
                {
                    "date": 1736494321788,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,95 @@\n+# Script to fix common Gradle issues in React Native Android builds\r\n+\r\n+Write-Host \"Stopping Gradle daemon...\"\r\n+./gradlew --stop\r\n+\r\n+# Kill any running Java processes\r\n+Write-Host \"Stopping Java processes...\"\r\n+Get-Process -Name \"*java*\" -ErrorAction SilentlyContinue | Stop-Process -Force\r\n+\r\n+# Set correct Java home\r\n+$javaHome = \"C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.13.11-hotspot\"\r\n+if (Test-Path $javaHome) {\r\n+    Write-Host \"Setting JAVA_HOME to $javaHome\"\r\n+    $env:JAVA_HOME = $javaHome\r\n+    \r\n+    # Also update the Path\r\n+    $env:Path = \"$javaHome\\bin;$env:Path\"\r\n+} else {\r\n+    Write-Error \"Java 17 not found at $javaHome. Please install JDK 17.\"\r\n+    exit 1\r\n+}\r\n+\r\n+# Clean Gradle caches\r\n+Write-Host \"Cleaning Gradle caches...\"\r\n+$gradleHome = \"$env:USERPROFILE\\.gradle\"\r\n+if (Test-Path $gradleHome) {\r\n+    try {\r\n+        # Remove specific problematic directories\r\n+        Remove-Item \"$gradleHome\\caches\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+        Remove-Item \"$gradleHome\\daemon\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+        Remove-Item \"$gradleHome\\wrapper\\dists\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    } catch {\r\n+        Write-Warning \"Some files could not be deleted. This is normal if Gradle is still running.\"\r\n+    }\r\n+}\r\n+\r\n+# Recreate essential directories\r\n+Write-Host \"Recreating essential directories...\"\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\caches\" | Out-Null\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\daemon\" | Out-Null\r\n+New-Item -ItemType Directory -Force -Path \"$gradleHome\\wrapper\\dists\" | Out-Null\r\n+\r\n+# Clean Android build directories\r\n+Write-Host \"Cleaning Android build directories...\"\r\n+Remove-Item \"app\\build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+Remove-Item \"build\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+Remove-Item \".gradle\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+\r\n+# Update Gradle wrapper properties to use correct version\r\n+Write-Host \"Updating Gradle wrapper properties...\"\r\n+$wrapperContent = @\"\r\n+distributionBase=GRADLE_USER_HOME\r\n+distributionPath=wrapper/dists\r\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-7.6.3-bin.zip\r\n+networkTimeout=10000\r\n+validateDistributionUrl=true\r\n+zipStoreBase=GRADLE_USER_HOME\r\n+zipStorePath=wrapper/dists\r\n+\"@\r\n+$wrapperPath = \"gradle\\wrapper\\gradle-wrapper.properties\"\r\n+$wrapperContent | Set-Content $wrapperPath -Force\r\n+\r\n+# Update local.properties with correct SDK path\r\n+Write-Host \"Updating local.properties...\"\r\n+$localProperties = \"local.properties\"\r\n+$sdkDir = $env:ANDROID_HOME -replace \"\\\\\", \"\\\\\"\r\n+if ($sdkDir) {\r\n+    \"sdk.dir=$sdkDir\" | Set-Content $localProperties -Force\r\n+}\r\n+\r\n+# Download and install Gradle wrapper\r\n+Write-Host \"Installing Gradle wrapper...\"\r\n+./gradlew wrapper --gradle-version 7.6.3 --distribution-type bin\r\n+\r\n+# Clean and build project\r\n+Write-Host \"Cleaning and building project...\"\r\n+./gradlew clean\r\n+\r\n+Write-Host \"Building project with debug info...\"\r\n+./gradlew assembleDebug --info\r\n+\r\n+# Additional cleanup if needed\r\n+if ($LASTEXITCODE -ne 0) {\r\n+    Write-Host \"Build failed. Trying additional cleanup...\"\r\n+    \r\n+    # Remove node_modules/.cache\r\n+    Remove-Item \"../node_modules/.cache\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    \r\n+    # Clear Metro bundler cache\r\n+    Remove-Item \"$env:TEMP/metro-*\" -Recurse -Force -ErrorAction SilentlyContinue\r\n+    \r\n+    # Try rebuild\r\n+    Write-Host \"Attempting rebuild...\"\r\n+    ./gradlew clean assembleDebug --info\r\n+}\r\n"
                }
            ],
            "date": 1736487474147,
            "name": "Commit-0",
            "content": "# Stop any running Gradle daemons\r\nWrite-Host \"Stopping Gradle daemon...\"\r\n./gradlew --stop\r\n\r\n# Set Java 17 environment variables\r\n$javaHome = \"C:\\Users\\tfunk\\.gradle\\jdks\\eclipse_adoptium-17-amd64-windows.2\"\r\n$env:JAVA_HOME = $javaHome\r\n$env:PATH = \"$javaHome\\bin;$env:PATH\"\r\n\r\n# Verify Java version\r\nWrite-Host \"Verifying Java version...\"\r\njava -version\r\n\r\n# Clean Gradle caches thoroughly\r\nWrite-Host \"Cleaning Gradle caches...\"\r\n$gradleHome = \"$env:USERPROFILE\\.gradle\"\r\n\r\n# Remove specific problematic directories\r\n$dirsToRemove = @(\r\n    \"caches\\8.10.2\",\r\n    \"caches\\transforms-*\",\r\n    \"caches\\build-cache-*\",\r\n    \"daemon\",\r\n    \"native\",\r\n    \"workers\"\r\n)\r\n\r\nforeach ($dir in $dirsToRemove) {\r\n    $path = Join-Path $gradleHome $dir\r\n    if (Test-Path $path) {\r\n        Write-Host \"Removing $path...\"\r\n        Remove-Item -Path $path -Recurse -Force -ErrorAction SilentlyContinue\r\n    }\r\n}\r\n\r\n# Clean Android build directories\r\nWrite-Host \"Cleaning Android build directories...\"\r\nRemove-Item -Path \"build\" -Recurse -Force -ErrorAction SilentlyContinue\r\nRemove-Item -Path \"app/build\" -Recurse -Force -ErrorAction SilentlyContinue\r\nRemove-Item -Path \".gradle\" -Recurse -Force -ErrorAction SilentlyContinue\r\n\r\n# Clean project\r\nWrite-Host \"Cleaning project...\"\r\n./gradlew clean\r\n\r\n# Update Gradle wrapper\r\nWrite-Host \"Updating Gradle wrapper...\"\r\n./gradlew wrapper --gradle-version 8.0.0\r\n\r\n# Build project with debug info\r\nWrite-Host \"Building project...\"\r\n./gradlew assembleDebug --info --stacktrace --no-daemon\r\n"
        }
    ]
}